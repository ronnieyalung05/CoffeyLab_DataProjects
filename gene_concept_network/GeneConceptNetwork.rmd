```{r}
# -----------------------------
# Step 0: Install/load necessary packages
# -----------------------------
if (!requireNamespace("BiocManager", quietly = TRUE)) install.packages("BiocManager")

# Install Bioconductor packages if not already installed
BiocManager::install(c("clusterProfiler", "org.Hs.eg.db", "enrichplot", "cowplot"), ask=FALSE)

# Install CRAN packages if not already installed
install.packages("dplyr")

# Load libraries
library(clusterProfiler)
library(org.Hs.eg.db)
library(enrichplot)
library(cowplot)
library(dplyr)
```

```{r}
# -----------------------------
# Step 1: Prepare gene list
# -----------------------------
# Assume protein_data_normalized is your dataframe with a column "GeneSymbols"
s <- gpr_list$HNPCC_CL$GeneSymbol

gene_data <- sample_data_normalized %>%
  select(GeneSymbol) %>%
  distinct()

# TODO: need to figure out how we want to choose what genes were looking at, because there's way too much data at the moment
gene_symbols <- toupper(trimws(gene_data$GeneSymbol))  # clean symbols

# -----------------------------
# Step 2: Map GeneSymbols â†’ Entrez IDs
# -----------------------------
gcn_data <- bitr(
  gene_symbols,
  fromType = "SYMBOL",
  toType = "ENTREZID",
  OrgDb = org.Hs.eg.db
)

mapped_genes   <- gcn_data$SYMBOL
unmapped_genes <- setdiff(gene_symbols, mapped_genes)
cat("Number of mapped genes:", length(mapped_genes), "\n")
cat("Number of unmapped genes:", length(unmapped_genes), "\n")

entrez_ids <- gcn_data$ENTREZID

# -----------------------------
# Step 3: Run GO enrichment (Biological Process)
# -----------------------------
edo <- enrichGO(
  gene = entrez_ids,
  OrgDb = org.Hs.eg.db,
  keyType = "ENTREZID",
  ont = "BP",            # Change ONTOLOGY here. Can only do one at a time
  pAdjustMethod = "BH",
  pvalueCutoff = 0.05,
  qvalueCutoff = 0.2
)


# -----------------------------
# Step 4: Convert to readable gene symbols
# -----------------------------
edox <- setReadable(edo, OrgDb = 'org.Hs.eg.db', keyType = 'ENTREZID')

rm(edo, gene_data)
```


```{r}
# -----------------------------
# Step 5: Make cnetplots (no fold-change, no filtering)
# -----------------------------
# Basic
p1 <- cnetplot(edox)

# Category node size scaled by p-value
p2 <- cnetplot(edox, showCategory = 2)
p2

# Circular layout with colored edges
p3 <- cnetplot(edox, circular = TRUE, colorEdge = TRUE)

# Combine plots
cowplot::plot_grid(
  p1, p2, p3,
  ncol = 3,
  labels = LETTERS[1:3],
  rel_widths = c(.8, .8, 1.2)
)
```